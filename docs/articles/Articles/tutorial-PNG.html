<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started With ArchR • ArchR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Getting Started With ArchR">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">ArchR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/Articles/tutorial.html">Tutorial</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/Articles/doubletRemoval.html">Doublet Removal</a>
    </li>
    <li>
      <a href="../../articles/Articles/qcFilters.html">QC Filters</a>
    </li>
    <li>
      <a href="../../articles/Articles/peakCalling.html">Peak Calling</a>
    </li>
    <li>
      <a href="../../articles/Articles/dimReduction.html">Dimensionality Reduction</a>
    </li>
    <li>
      <a href="../../articles/Articles/geneScores.html">Gene Activity Scores</a>
    </li>
    <li>
      <a href="../../articles/Articles/markerFeatures.html">Marker Feature Identification</a>
    </li>
    <li>
      <a href="../../articles/Articles/signalTracks.html">Signal Track Ploting</a>
    </li>
    <li>
      <a href="../../articles/Articles/footprinting.html">TF Footprinting</a>
    </li>
    <li>
      <a href="../../articles/Articles/pseudobulkGeneration.html">Pseudobulk Replicate Generation</a>
    </li>
    <li>
      <a href="../../articles/Articles/annotations.html">Gene and Genome Annotation</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/Articles/faq.html">FAQ</a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/GreenleafLab/ArchR">
    <span class="fa fa-github"></span>
     
    ArchR on GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting Started With ArchR</h1>
            
      
      
      <div class="hidden name"><code>tutorial-PNG.Rmd</code></div>

    </div>

    
    
<style>h4 > span, h5 > span, h6 > span, h7 > span, h8 > span, h9 > span, h10 > .header-section-number { display: none; } </style>
<div id="please-view-the-tutorial-in-safari-firefox-or-internet-explorer-chromes-pdf-viewer-doesnt-load-all-of-the-pdfs-in-the-tutorial-" class="section level2">
<h2 class="hasAnchor">
<a href="#please-view-the-tutorial-in-safari-firefox-or-internet-explorer-chromes-pdf-viewer-doesnt-load-all-of-the-pdfs-in-the-tutorial-" class="anchor"></a>Please view the tutorial in safari, firefox or internet explorer (chrome’s pdf viewer doesnt load all of the pdf’s in the tutorial).</h2>
<p>The following tutorial shows the basics of setting up and interacting with an ArchR Project using a gold-standard downsampled dataset of hematopoietic cells <a href="https://www.ncbi.nlm.nih.gov/pubmed/31792411">Granja* et al. Nature Biotechnology 2019</a>. This tutorial and all of the accompanying vignettes assume that you are running ArchR <strong>locally</strong>. Once all of these steps work for you, feel free to <a href="articles/Articles/clusterComputing.html">set up ArchR to work in a cluster environment</a>. This tutorial does not explain every detail of every step. Please see the <a href="articles/index.html">Vignettes section</a> for more details on each major analytical step and all of the major features of ArchR.</p>
</div>
<div id="what-is-an-arrowfile-archrproject" class="section level1">
<h1 class="hasAnchor">
<a href="#what-is-an-arrowfile-archrproject" class="anchor"></a>What is an <code>ArrowFile</code> / <code>ArchRProject</code>?</h1>
<p>The base unit of an analytical project in ArchR is called an <code>ArrowFile</code>. Each <code>ArrowFile</code>, stores all of the data associated with an individual sample (i.e. metadata, accessible fragments and data matrices). Here, a sample would be the most detailed unit of analysis desired (for ex. a single replicate of a particular condition). During creation and as additional analyses are performed, ArchR updates and edits each <code>ArrowFile</code> to contain additional layers of information. Then, an <code>ArchRProject</code> allows you to associate these <code>ArrowFiles</code> together into a single analytical framework.</p>
<center>
<img src="../../images/ArchRProject_Schematic.png" width="700">
</center>
<p>Certain actions can be taken directly on <code>ArrowFiles</code> while other actions are taken on an <code>ArchRProject</code> which in turn updates each associated <code>ArrowFile</code>. Because <code>ArrowFiles</code> are stored as large HDF5-format files, “get-er” functions in ArchR retrieve data by interacting with the <code>ArchRProject</code>.</p>
<center>
<img src="../../images/ArchR_FunctionSchematic.png" width="400">
</center>
</div>
<div id="getting-set-up" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-set-up" class="anchor"></a>Getting Set Up</h1>
<p>The first thing we do is set up our working directory, load our genome annotations, and set the number of threads we would like to use. Depending on the configuration of your local environment, you may need to modify the number of <code>threads</code> used below in <code>addArchRThreads</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co">#Load R Libraries</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ArchR)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#Set/Create Working Directory to Folder for Analysis</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5">wd &lt;-<span class="st"> ""</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span>(wd, <span class="dt">showWarnings =</span> <span class="ot">FALSE</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">setwd</a></span>(wd)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#Load Genome Annotations. Available annotations are for Hg19, Hg38, Mm9, or Mm10. </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#(Note if you want to build a custom annotation see createGeneAnnotation or createGenomeAnnotation).</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"geneAnnoHg19"</span>)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"genomeAnnoHg19"</span>)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">geneAnno &lt;-<span class="st"> </span>geneAnnoHg19</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">genomeAnno &lt;-<span class="st"> </span>genomeAnnoHg19</a>
<a class="sourceLine" id="cb1-15" data-line-number="15"></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#Set Default Threads for ArchR Functions</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#By default ArchR uses the total number of cores available / 2. If windows this will be set to 1.</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="kw"><a href="../../reference/addArchRThreads.html">addArchRThreads</a></span>()</a></code></pre></div>
</div>
<div id="creating-arrow-files" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#creating-arrow-files" class="anchor"></a>Creating Arrow Files</h1>
<p>For this tutorial, we will download a collection of fragment files. Fragment files are one of the base file types of the 10x Genomics analytical platform (and others) and can be easily created from any bam file. See <a href="articles/Articles/inputFiles.html">the ArchR input types vignette</a> for information on making your own fragment files. Once we have our fragment files, we provide their names as a character vector to <code>createArrowFiles</code>. During creation, some basic matrices and data is added to each <code>ArrowFile</code> including a <code>TileMatrix</code> containing insertion counts across genome-wide 500-bp bins (see <code>addTileMatrix</code>) and a <code>GeneScoreMatrix</code> that is determined based on weighting insertion counts in tiles nearby a gene promoter (see <code>addGeneScoreMatrix</code>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#Get Tutorial Data ~2.2GB To Download (if downloaded already ArchR will bypass downloading).</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">inputFiles &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getTutorialData.html">getTutorialData</a></span>(<span class="st">"Hematopoiesis"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#Create Arrow Files (~10-15 minutes) w/ helpful messages displaying progress.</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#This step will for each sample :</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># 1. Read Accessible Fragments.</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># 2. Identify Cells QC Information (TSS Enrichment, Nucleosome info).</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co"># 3. Filter Cells based on QC parameters.</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># 4. Create a TileMatrix 500-bp genome-wide.</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co"># 5. Create a GeneScoreMatrix.</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">ArrowFiles &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/createArrowFiles.html">createArrowFiles</a></span>(</a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="dt">inputFiles =</span> inputFiles,</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="dt">sampleNames =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(inputFiles),</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  <span class="dt">geneAnno =</span> geneAnno,</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">  <span class="dt">genomeAnno =</span> genomeAnno</a>
<a class="sourceLine" id="cb2-16" data-line-number="16">)</a></code></pre></div>
<hr>
<div id="qc-tss-scores-by-unique-fragments" class="section level2">
<h2 class="hasAnchor">
<a href="#qc-tss-scores-by-unique-fragments" class="anchor"></a>QC TSS Scores by Unique Fragments</h2>
Since this was plotted prior to creation of an ArchRProject we go to QualityControl/scATAC_BMMC_R2/scATAC_BMMC_R2-TSS_by_Unique_Frags.pdf for the plot below.
<center>
<embed src="../../images/Tutorial/scATAC_BMMC_R2-TSS_by_Unique_Frags.pdf" width="450" height="450"></embed>
</center>
</div>
<div id="qc-fragment-size-distribution" class="section level2">
<h2 class="hasAnchor">
<a href="#qc-fragment-size-distribution" class="anchor"></a>QC Fragment Size Distribution</h2>
Since this was plotted prior to creation of an ArchRProject we go to QualityControl/scATAC_BMMC_R2/scATAC_BMMC_R2-Fragment_Size_Distribution.pdf for the plot below.
<center>
<embed src="../../images/Tutorial/scATAC_BMMC_R2-Fragment_Size_Distribution.pdf" width="450" height="350"></embed>
</center>
</div>
</div>
<div id="tidying-up-our-data-and-creating-an-archrproject" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#tidying-up-our-data-and-creating-an-archrproject" class="anchor"></a>Tidying up our data and creating an <code>ArchRProject</code>
</h1>
<p>One major source of trouble in single-cell data is the contribution of “doublets” to the analysis. A doublet refers to a single droplet that received a single barcoded bead and more than one nucleus. This causes the reads from more than one cell to appear as a single cell. We remove these computationally and describe this doublet removal process in more depth in the <a href="articles/Articles/doubletRemoval.html">doublet removal vignette</a>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co">#Add Infered Doublet Scores to each Arrow File (~2-5 min per sample)</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">doubScores &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addDoubletScores.html">addDoubletScores</a></span>(ArrowFiles)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#Create ArchRProject</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#The outputDirectory here describes where all downstream analyses and plots go.</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/ArchRProject.html">ArchRProject</a></span>(</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  <span class="dt">ArrowFiles =</span> ArrowFiles, </a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  <span class="dt">geneAnnotation =</span> geneAnno,</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">  <span class="dt">genomeAnnotation =</span> genomeAnno,</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="dt">outputDirectory =</span> <span class="st">"Heme_Tutorial"</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#To see information about ArchR Project created simply input</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14">proj</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#We can now visualize numeric metadata per grouping with a violin plot now that we have created an ArchR Project.</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#For example we will plot TSS / Doublet Enrichment Scores per sample.</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb3-19" data-line-number="19">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb3-20" data-line-number="20">  <span class="dt">groupBy =</span> <span class="st">"Sample"</span>, </a>
<a class="sourceLine" id="cb3-21" data-line-number="21">  <span class="dt">colorBy =</span> <span class="st">"colData"</span>, </a>
<a class="sourceLine" id="cb3-22" data-line-number="22">  <span class="dt">name =</span> <span class="st">"TSSEnrichment"</span>,</a>
<a class="sourceLine" id="cb3-23" data-line-number="23">)</a>
<a class="sourceLine" id="cb3-24" data-line-number="24">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb3-25" data-line-number="25">  <span class="dt">groupBy =</span> <span class="st">"Sample"</span>, </a>
<a class="sourceLine" id="cb3-26" data-line-number="26">  <span class="dt">colorBy =</span> <span class="st">"colData"</span>, </a>
<a class="sourceLine" id="cb3-27" data-line-number="27">  <span class="dt">name =</span> <span class="st">"DoubletEnrichment"</span>,</a>
<a class="sourceLine" id="cb3-28" data-line-number="28">)</a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"TSS-Doublet-Enrichment"</span>, <span class="dt">width =</span> <span class="dv">4</span>, <span class="dt">height =</span> <span class="dv">4</span>,  <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-30" data-line-number="30"></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="co">#Filter Doublets</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"><span class="co">#The automatic filtering rate will be based on how many cells are in the sample, if there</span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="co">#are 5,000 cells ArchR will remove up to 250 (~5%) of the cells. If you believe more cells</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="co">#should be excluded change the filterRatio argument apropriately.</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/filterDoublets.html">filterDoublets</a></span>(proj)</a></code></pre></div>
<hr>
<div id="example-doublet-results" class="section level2">
<h2 class="hasAnchor">
<a href="#example-doublet-results" class="anchor"></a>Example Doublet Results</h2>
Since this was plotted prior to creation of an ArchRProject we go to QualityControl/scATAC_BMMC_R2/scATAC_BMMC_R2-Doublet-Summary.pdf for the plot below.<br><br><center>
<embed src="../../images/Tutorial/scATAC_BMMC_R2-Doublet-Summary.pdf" width="450" height="450"></embed>
</center>
</div>
<div id="tss-doublet-enrichment" class="section level2">
<h2 class="hasAnchor">
<a href="#tss-doublet-enrichment" class="anchor"></a>TSS / Doublet Enrichment</h2>
<br><br><center>
<embed src="../../images/Tutorial/TSS-Doublet-Enrichment.pdf" width="450" height="450"></embed>
</center>
</div>
</div>
<div id="dimensionality-reduction" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#dimensionality-reduction" class="anchor"></a>Dimensionality Reduction</h1>
<p>At this point, we have an ArchR project that is ready to be used in downstream visualizations and analyses. The first thing we will do is use an iterative latent semantic indexing (LSI) approach to define clusters in our data. Once we have identified clusters in our data, we can plot a UMAP embedding. For more details, see the <a href="articles/Articles/dimReduction.html">dimensionality reduction vignette</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">#Reduce Dimensions with Iterative LSI (~5-10 minutes)</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addIterativeLSI.html">addIterativeLSI</a></span>(</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">useMatrix =</span> <span class="st">"TileMatrix"</span>, </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">reducedDimsOut =</span> <span class="st">"IterativeLSI"</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#Identify Clusters from Iterative LSI</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#By default ArchR uses Seurat's FindClusters function because it is fast/robust producing reasonable clustering.</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#The larger the resolution the more clusters will be called. The lower the resolution hte less clusters will be called.</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#It is recommended to compare the results from your clusters and your embeddings and find params that best agree across</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#both analyses for clarity.</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addClusters.html">addClusters</a></span>(<span class="dt">input =</span> proj, <span class="dt">reducedDims =</span> <span class="st">"IterativeLSI"</span>, <span class="dt">resolution =</span> <span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#Compute a UMAP embedding to visualize our tiled accessibility matrix in a 2-d setting.</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addEmbedding.html">addEmbedding</a></span>(</a>
<a class="sourceLine" id="cb4-17" data-line-number="17">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb4-18" data-line-number="18">  <span class="dt">reducedDims =</span> <span class="st">"IterativeLSI"</span>, </a>
<a class="sourceLine" id="cb4-19" data-line-number="19">  <span class="dt">embedding =</span> <span class="st">"UMAP"</span>, </a>
<a class="sourceLine" id="cb4-20" data-line-number="20">  <span class="dt">embeddingParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">min_dist =</span> <span class="fl">0.4</span>) <span class="co">#see uwot::umap for alternative params</span></a>
<a class="sourceLine" id="cb4-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb4-22" data-line-number="22"></a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="co">#Plot the UMAP Embedding with Metadata Overlayed such as Experimental Sample and Clusters.</span></a>
<a class="sourceLine" id="cb4-24" data-line-number="24"><span class="co">#To change plotting aesthetics see ?plotEmbedding parameters.</span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb4-26" data-line-number="26">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Sample"</span>)</a>
<a class="sourceLine" id="cb4-27" data-line-number="27">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb4-28" data-line-number="28"><span class="co">#Different ArchRPalette "circus"</span></a>
<a class="sourceLine" id="cb4-29" data-line-number="29">plotList[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">discreteSet =</span> <span class="st">"circus"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb4-30" data-line-number="30"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Samples-Clusters"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<hr>
<div id="umap-w-clusters" class="section level2 tabset tabset-fade tabset-pills">
<h2 class="hasAnchor">
<a href="#umap-w-clusters" class="anchor"></a>UMAP w/ Clusters</h2>
<p>This <a href="../../images/Tutorial/UMAP-Samples-Clusters.pdf">plot</a> shows gene experimental samples and clusters described above overlayed onto the UMAP embedding. (Note if you see a blank space below try firefox or safari)</p>
<div id="section" class="section level3">
<h3 class="hasAnchor">
<a href="#section" class="anchor"></a>1</h3>
<p><img src="../../images/Tutorial/UMAP-Samples-Clusters_1.png" width="600" height="600"></p>
</div>
<div id="section-1" class="section level3">
<h3 class="hasAnchor">
<a href="#section-1" class="anchor"></a>2</h3>
<p><img src="../../images/Tutorial/UMAP-Samples-Clusters_2.png" width="600" height="600"></p>
</div>
<div id="section-2" class="section level3">
<h3 class="hasAnchor">
<a href="#section-2" class="anchor"></a>3</h3>
<p><img src="../../images/Tutorial/UMAP-Samples-Clusters_3.png" width="600" height="600"></p>
</div>
</div>
<div id="tsne-w-clusters" class="section level2">
<h2 class="hasAnchor">
<a href="#tsne-w-clusters" class="anchor"></a>TSNE w/ Clusters</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">#Compute a TSNE embedding to visualize our tiled accessibility matrix in a 2-d setting.</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addEmbedding.html">addEmbedding</a></span>(</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="dt">reducedDims =</span> <span class="st">"IterativeLSI"</span>, </a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  <span class="dt">embeddingParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">perplexity =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#Plot the TSNE Embedding with Metadata Overlayed such as Experimental Sample and Clusters.</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#To change plotting aesthetics see ?plotEmbedding parameters.</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, <span class="dt">name =</span> <span class="st">"Sample"</span>)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="co">#Different ArchRPalette "circus"</span></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">plotList[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">embedding =</span> <span class="st">"Rtsne"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">discreteSet =</span> <span class="st">"circus"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"TSNE-Samples-Clusters"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/TSNE-Samples-Clusters.pdf" width="450" height="450"></embed>
</center>
</div>
<div id="umap-w-custom-coldata" class="section level2">
<h2 class="hasAnchor">
<a href="#umap-w-custom-coldata" class="anchor"></a>UMAP w/ Custom ColData</h2>
<p>To add your own information for plotting ontop of UMAP embedding we will show an example here.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co">#Get Cell Names</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">cellNames &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getCellNames.html">getCellNames</a></span>(<span class="dt">ArchRProj =</span> proj)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#Get Sample names</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">sampleNames &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getCellColData.html">getCellColData</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">select =</span> <span class="st">"Sample"</span>, <span class="dt">drop =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#Remove Replicate Name</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">sampleNames &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"_R1"</span>, <span class="st">""</span>, <span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">"_R2"</span>, <span class="st">""</span>, sampleNames))</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co">#Add Info to cellColData</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addCellColData.html">addCellColData</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">data =</span> sampleNames, <span class="dt">cellNames =</span> cellNames, <span class="dt">name =</span> <span class="st">"Type"</span>)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#Plot the UMAP Embedding with Metadata Overlayed such as Experimental Sample and Clusters.</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#To change plotting aesthetics see ?plotEmbedding parameters.</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Type"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Type"</span>, <span class="dt">discreteSet =</span> <span class="st">"circus"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb6-18" data-line-number="18"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Samples-Type"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/UMAP-Samples-Type.pdf" width="450" height="450"></embed>
</center>
</div>
</div>
<div id="identifying-cluster-cell-types-using-marker-genes" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#identifying-cluster-cell-types-using-marker-genes" class="anchor"></a>Identifying Cluster Cell Types Using Marker Genes</h1>
<p>In order to understand which clusters correspond to which cell types, we use a supervised approach based on prior knowledge of the genes that are active in specific cell types. We determine <em>gene activity scores</em> for each putative marker gene based on chromatin accessibility signal in the region surrounding the gene’s promoter. We can then overlay these <em>gene activity scores</em> on our UMAP embedding to visualize the relationship between gene activity and cluster. For more details, see the <a href="articles/Articles/geneScores.html">marker genes vignette</a>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co">#Add Imputation Weights for imputing numerical values based on Magic (see van Dijk et. al. 2018).</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addImputeWeights.html">addImputeWeights</a></span>(<span class="dt">ArchRProj =</span> proj)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"></a>
<a class="sourceLine" id="cb7-4" data-line-number="4">markerGenes  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">    <span class="st">"CD34"</span>, <span class="co">#Early Progenitor</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6">    <span class="st">"GATA1"</span>, <span class="co">#Erythroid</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">    <span class="st">"PAX5"</span>, <span class="st">"MS4A1"</span>, <span class="co">#B-Cell Trajectory</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">    <span class="st">"CD14"</span>, <span class="co">#Monocytes</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">    <span class="st">"CD3D"</span>, <span class="st">"CD8A"</span>, <span class="st">"TBX21"</span>, <span class="st">"IL7R"</span> <span class="co">#TCells</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb7-11" data-line-number="11"></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#Plot the UMAP Embedding with Marker Genes Overlayed w/ Imputation</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb7-14" data-line-number="14">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"GeneScoreMatrix"</span>, <span class="dt">name =</span> markerGenes, <span class="dt">imputeWeights =</span> <span class="kw"><a href="../../reference/getImputeWeights.html">getImputeWeights</a></span>(proj))</a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Marker-Gene-Scores-w-Imputation"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-16" data-line-number="16"></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#Plot the UMAP Embedding with Marker Genes Overlayed w/o Imputation</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb7-19" data-line-number="19">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"GeneScoreMatrix"</span>, <span class="dt">name =</span> markerGenes)</a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Marker-Gene-Scores-wo-Imputation"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-21" data-line-number="21"></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#Plot Tracks at Marker Genes</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23">plotTracks &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/ArchRRegionTrack.html">ArchRRegionTrack</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">geneSymbol =</span> markerGenes)</a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotTracks, <span class="dt">name =</span> <span class="st">"Plot-Tracks-Marker-Genes"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">8</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb7-25" data-line-number="25"></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#Identify Marker Gene through Pairwise Test vs Bias-Matched Background </span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27">markersGS &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerFeatures.html">markerFeatures</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">useMatrix =</span> <span class="st">"GeneScoreMatrix"</span>, <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>)</a>
<a class="sourceLine" id="cb7-28" data-line-number="28">heatmapGS &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerHeatmap.html">markerHeatmap</a></span>(</a>
<a class="sourceLine" id="cb7-29" data-line-number="29">  <span class="dt">seMarker =</span> markersGS, </a>
<a class="sourceLine" id="cb7-30" data-line-number="30">  <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.01 &amp; Log2FC &gt;= 1"</span>, </a>
<a class="sourceLine" id="cb7-31" data-line-number="31">  <span class="dt">labelMarkers =</span> markerGenes</a>
<a class="sourceLine" id="cb7-32" data-line-number="32">)</a>
<a class="sourceLine" id="cb7-33" data-line-number="33"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(heatmapGS, <span class="dt">name =</span> <span class="st">"GeneScores-Marker-Heatmap"</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<hr>
<div id="umap-genescores-w-imputation" class="section level2">
<h2 class="hasAnchor">
<a href="#umap-genescores-w-imputation" class="anchor"></a>UMAP GeneScores w/ Imputation</h2>
This <a href="../../images/Tutorial/UMAP-Marker-Gene-Scores-w-Imputation.pdf">plot</a> shows gene activity scores of the marker genes described above overlayed onto the UMAP embedding. The gene scores are imputed using Magic when running addImupteWeights. (Note if you see a blank space below try firefox or safari) <br><br><center>
<embed src="../../images/Tutorial/UMAP-Marker-Gene-Scores-w-Imputation.pdf" width="450" height="450"></embed>
</center>
</div>
<div id="umap-genescores-wo-imputation" class="section level2">
<h2 class="hasAnchor">
<a href="#umap-genescores-wo-imputation" class="anchor"></a>UMAP GeneScores w/o Imputation</h2>
This <a href="../../images/Tutorial/UMAP-Marker-Gene-Scores-wo-Imputation.pdf">plot</a> shows gene activity scores of the marker genes described above overlayed onto the UMAP embedding. (Note if you see a blank space below try firefox or safari) <br><br><center>
<embed src="../../images/Tutorial/UMAP-Marker-Gene-Scores-wo-Imputation.pdf" width="450" height="450"></embed>
</center>
</div>
<div id="track-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#track-plots" class="anchor"></a>Track-Plots</h2>
<br><br><center>
<embed src="../../images/Tutorial/Plot-Tracks-Marker-Genes.pdf" width="450" height="600"></embed>
</center>
</div>
<div id="marker-genescores-heatmap" class="section level2">
<h2 class="hasAnchor">
<a href="#marker-genescores-heatmap" class="anchor"></a>Marker GeneScores Heatmap</h2>
<br><br><center>
<embed src="../../images/Tutorial/GeneScores-Marker-Heatmap.pdf" width="450" height="600"></embed>
</center>
</div>
</div>
<div id="creating-a-reproducible-peak-set" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#creating-a-reproducible-peak-set" class="anchor"></a>Creating a Reproducible Peak Set</h1>
<p>One of the most complicated aspects about ATAC-seq and scATAC-seq analysis is the generation of a reproducible and robust peak set. In ArchR, we use an iterative overlap removal process that we first described in <a href="https://www.ncbi.nlm.nih.gov/pubmed/30361341">Corces* &amp; Granja* et al. Science 2018</a>. This process is described in detail in the <a href="articles/Articles/peakCalling.html">peak calling vignette</a>.</p>
<p>To robustly call peaks, we first merge the sparse single-cell data into pseudo-bulk replicates by aggregating the insertions from many individual cells into a single group. We make multiple pseudo-bulk replicates for each cluster to enable an assessment of peak reproducibility. This process of pseudo-bulk generation is described in detail in the <a href="articles/Articles/pseudobulkGeneration.html">pseudo-bulk generation vignette</a>. We than call peaks using <a href="https://github.com/taoliu/MACS">MACS2</a> and perform our iterative overlap removal. Once we obtain a finalized non-overlapping peak set, we can then collect insertion counts in each peak for each single cell and associate this with the corresponding <code>ArrowFile</code> via the <code>ArchRProject</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#Create Group Coverage Files that can be used for downstream analysis (~5-10 minutes)</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addGroupCoverages.html">addGroupCoverages</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#Call Reproducible Peaks w/ Macs2 (~5-10 minutes)</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addReproduciblePeakSet.html">addReproduciblePeakSet</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="co">#Add Peak Matrix</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addPeakMatrix.html">addPeakMatrix</a></span>(<span class="dt">ArchRProj =</span> proj)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9"></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#We can now plot the fraction of reads/insertions for each cell per sample and see how that compares to TSS Enrichment scores.</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  <span class="dt">groupBy =</span> <span class="st">"Sample"</span>, </a>
<a class="sourceLine" id="cb8-14" data-line-number="14">  <span class="dt">colorBy =</span> <span class="st">"colData"</span>, </a>
<a class="sourceLine" id="cb8-15" data-line-number="15">  <span class="dt">name =</span> <span class="st">"FRIP"</span>,</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">)</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb8-18" data-line-number="18">  <span class="dt">groupBy =</span> <span class="st">"Sample"</span>, </a>
<a class="sourceLine" id="cb8-19" data-line-number="19">  <span class="dt">colorBy =</span> <span class="st">"colData"</span>, </a>
<a class="sourceLine" id="cb8-20" data-line-number="20">  <span class="dt">name =</span> <span class="st">"TSSEnrichment"</span>,</a>
<a class="sourceLine" id="cb8-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb8-22" data-line-number="22"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"FRIP-TSS-Enrichment"</span>, <span class="dt">width =</span> <span class="dv">4</span>, <span class="dt">height =</span> <span class="dv">4</span>,  <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div id="reproducible-peaks-per-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#reproducible-peaks-per-cluster" class="anchor"></a>Reproducible Peaks per Cluster</h2>
<br><br><center>
<embed src="../../images/Tutorial/Peak-Call-Summary.pdf" width="600" height="400"></embed>
</center>
</div>
<div id="frip-tss-enrichment-per-sample" class="section level2">
<h2 class="hasAnchor">
<a href="#frip-tss-enrichment-per-sample" class="anchor"></a>FRIP / TSS Enrichment Per Sample</h2>
<br><br><center>
<embed src="../../images/Tutorial/FRIP-TSS-Enrichment.pdf" width="450" height="450"></embed>
</center>
</div>
</div>
<div id="identifying-marker-peaks" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#identifying-marker-peaks" class="anchor"></a>Identifying Marker Peaks</h1>
<p>Often times, we are interested to know which peaks are unique to an individual cluster or a small group of clusters. We can do this in an unsupervised fashion in ArchR:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co">#Identify Marker Peaks</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">markersPeaks &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerFeatures.html">markerFeatures</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">useMatrix =</span> <span class="st">"PeakMatrix"</span>, <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#Visualize Markers as a heatmap</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">heatmapPeaks &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerHeatmap.html">markerHeatmap</a></span>(</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">seMarker =</span> markersPeaks, </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; Log2FC &gt;= 1"</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(heatmapPeaks, <span class="dt">name =</span> <span class="st">"Peak-Marker-Heatmap"</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div id="markers-heatmap" class="section level2">
<h2 class="hasAnchor">
<a href="#markers-heatmap" class="anchor"></a>Markers Heatmap</h2>
<br><br><center>
<embed src="../../images/Tutorial/Peak-Marker-Heatmap.pdf" width="450" height="600"></embed>
</center>
</div>
<div id="markers-mavolcano-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#markers-mavolcano-plot" class="anchor"></a>Markers MA/Volcano-Plot</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co">#Marker Peaks for Cluster 6 (Erythroid)</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerPlot.html">markerPlot</a></span>(<span class="dt">seMarker =</span> markersPeaks, <span class="dt">name =</span> <span class="st">"Cluster6"</span>, <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; abs(Log2FC) &gt;= 1"</span>, <span class="dt">plotAs =</span> <span class="st">"MA"</span>)</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerPlot.html">markerPlot</a></span>(<span class="dt">seMarker =</span> markersPeaks, <span class="dt">name =</span> <span class="st">"Cluster6"</span>, <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; abs(Log2FC) &gt;= 1"</span>, <span class="dt">plotAs =</span> <span class="st">"Volcano"</span>)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Cluster6-Marker-Peaks"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Cluster6-Marker-Peaks.pdf" width="450" height="450"></embed>
</center>
</div>
<div id="pairwise-test" class="section level2">
<h2 class="hasAnchor">
<a href="#pairwise-test" class="anchor"></a>Pairwise-Test</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co">#Pairwise Test between Cluster 6 (Erythroid) and Cluster 10 (B-Cells)</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">testClust6_<span class="dv">10</span> &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerFeatures.html">markerFeatures</a></span>(</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="dt">useMatrix =</span> <span class="st">"PeakMatrix"</span>,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  <span class="dt">testMethod =</span> <span class="st">"wilcoxon"</span>,</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  <span class="dt">bias =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TSSEnrichment"</span>, <span class="st">"log10(nFrags)"</span>),</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  <span class="dt">useGroups =</span> <span class="st">"Cluster6"</span>,</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">  <span class="dt">bgdGroups =</span> <span class="st">"Cluster10"</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#Plot Differential Plot</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerPlot.html">markerPlot</a></span>(<span class="dt">seMarker =</span> testClust6_<span class="dv">10</span>, <span class="dt">name =</span> <span class="st">"Cluster6"</span>, <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; abs(Log2FC) &gt;= 1"</span>, <span class="dt">plotAs =</span> <span class="st">"MA"</span>)</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/markerPlot.html">markerPlot</a></span>(<span class="dt">seMarker =</span> testClust6_<span class="dv">10</span>, <span class="dt">name =</span> <span class="st">"Cluster6"</span>, <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; abs(Log2FC) &gt;= 1"</span>, <span class="dt">plotAs =</span> <span class="st">"Volcano"</span>)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Cluster6-Cluster10-Marker-Peaks"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Cluster6-Cluster10-Marker-Peaks.pdf" width="450" height="450"></embed>
</center>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co">#Add Motif Peak Annotations if not already added!</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addMotifAnnotations.html">addMotifAnnotations</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">motifSet =</span> <span class="st">"cisbp"</span>, <span class="dt">name =</span> <span class="st">"Motif"</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#Identify Motif Enrichments</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">motifsUp &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/peakAnnoEnrichment.html">peakAnnoEnrichment</a></span>(</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">    <span class="dt">seMarker =</span> testClust6_<span class="dv">10</span>,</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">    <span class="dt">ArchRProj =</span> proj,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">    <span class="dt">peakAnnotation =</span> <span class="st">"Motif"</span>,</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">    <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; Log2FC &gt;= 0.5"</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb12-11" data-line-number="11"></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#Create data.frame</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13">df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">TF =</span> <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(motifsUp), <span class="dt">mlog10FDR =</span> <span class="kw">assay</span>(motifsUp)[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">df &lt;-<span class="st"> </span>df[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(df<span class="op">$</span>mlog10FDR, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>),]</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">df<span class="op">$</span>rank &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(df))</a>
<a class="sourceLine" id="cb12-16" data-line-number="16"></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#Ggplot</span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18">ggUp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(rank, mlog10FDR)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="st">  </span>ggrepel<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span>(</a>
<a class="sourceLine" id="cb12-21" data-line-number="21">        <span class="dt">data =</span> df[<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="dv">30</span>)), ], <span class="kw">aes</span>(<span class="dt">x =</span> rank, <span class="dt">y =</span> mlog10FDR, <span class="dt">label =</span> TF), </a>
<a class="sourceLine" id="cb12-22" data-line-number="22">        <span class="dt">size =</span> <span class="fl">1.5</span>,</a>
<a class="sourceLine" id="cb12-23" data-line-number="23">        <span class="dt">nudge_x =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb12-24" data-line-number="24">  ) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../../reference/theme_ArchR.html">theme_ArchR</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"-log10(FDR) Motif Enrichment"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">"Rank Sorted TFs Enriched"</span>)</a>
<a class="sourceLine" id="cb12-25" data-line-number="25"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(ggUp, <span class="dt">name =</span> <span class="st">"Cluster6-Cluster10-Motifs-Up"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Cluster6-Cluster10-Motifs-Up.pdf" width="450" height="450"></embed>
</center>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">motifsDo &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/peakAnnoEnrichment.html">peakAnnoEnrichment</a></span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    <span class="dt">seMarker =</span> testClust6_<span class="dv">10</span>,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    <span class="dt">ArchRProj =</span> proj,</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    <span class="dt">peakAnnotation =</span> <span class="st">"Motif"</span>,</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; Log2FC &lt;= -0.5"</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#Create data.frame</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">TF =</span> <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(motifsDo), <span class="dt">mlog10FDR =</span> <span class="kw">assay</span>(motifsDo)[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">df &lt;-<span class="st"> </span>df[<span class="kw"><a href="https://rdrr.io/r/base/order.html">order</a></span>(df<span class="op">$</span>mlog10FDR, <span class="dt">decreasing =</span> <span class="ot">TRUE</span>),]</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">df<span class="op">$</span>rank &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(df))</a>
<a class="sourceLine" id="cb13-12" data-line-number="12"></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="co">#Ggplot</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14">ggDo &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(rank, mlog10FDR)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="st">  </span>ggrepel<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span>(</a>
<a class="sourceLine" id="cb13-17" data-line-number="17">        <span class="dt">data =</span> df[<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span>(<span class="dv">30</span>)), ], <span class="kw">aes</span>(<span class="dt">x =</span> rank, <span class="dt">y =</span> mlog10FDR, <span class="dt">label =</span> TF), </a>
<a class="sourceLine" id="cb13-18" data-line-number="18">        <span class="dt">size =</span> <span class="fl">1.5</span>,</a>
<a class="sourceLine" id="cb13-19" data-line-number="19">        <span class="dt">nudge_x =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20">  ) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../../reference/theme_ArchR.html">theme_ArchR</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">"-log10(FDR) Motif Enrichment"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">"Rank Sorted TFs Enriched"</span>)</a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(ggDo, <span class="dt">name =</span> <span class="st">"Cluster6-Cluster10-Motifs-Down"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Cluster6-Cluster10-Motifs-Down.pdf" width="450" height="450"></embed>
</center>
</div>
</div>
<div id="performing-peak-annotation-enrichments" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#performing-peak-annotation-enrichments" class="anchor"></a>Performing Peak Annotation Enrichments</h1>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co">#Motif Search in Peak Set and add to Peak Annotations</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addMotifAnnotations.html">addMotifAnnotations</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">motifSet =</span> <span class="st">"cisbp"</span>, <span class="dt">name =</span> <span class="st">"Motif"</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#Identify Motif Enrichments</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">enrichMotifs &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/peakAnnoEnrichment.html">peakAnnoEnrichment</a></span>(</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">    <span class="dt">seMarker =</span> markersPeaks,</a>
<a class="sourceLine" id="cb14-7" data-line-number="7">    <span class="dt">ArchRProj =</span> proj,</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">    <span class="dt">peakAnnotation =</span> <span class="st">"Motif"</span>,</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">    <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; Log2FC &gt;= 0.5"</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">heatmapEM &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/enrichHeatmap.html">enrichHeatmap</a></span>(enrichMotifs, <span class="dt">n =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(heatmapEM, <span class="dt">name =</span> <span class="st">"Motifs-Enrich-Heatmap"</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb14-13" data-line-number="13"></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#Custom Peak Annotations</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15">EncodePeaks &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</a>
<a class="sourceLine" id="cb14-16" data-line-number="16">  <span class="dt">Encode_K562_GATA1 =</span> <span class="st">"https://www.encodeproject.org/files/ENCFF632NQI/@@download/ENCFF632NQI.bed.gz"</span>,</a>
<a class="sourceLine" id="cb14-17" data-line-number="17">  <span class="dt">Encode_GM12878_CEBPB =</span> <span class="st">"https://www.encodeproject.org/files/ENCFF761MGJ/@@download/ENCFF761MGJ.bed.gz"</span>,</a>
<a class="sourceLine" id="cb14-18" data-line-number="18">  <span class="dt">Encode_K562_Ebf1 =</span> <span class="st">"https://www.encodeproject.org/files/ENCFF868VSY/@@download/ENCFF868VSY.bed.gz"</span>,</a>
<a class="sourceLine" id="cb14-19" data-line-number="19">  <span class="dt">Encode_K562_Pax5 =</span> <span class="st">"https://www.encodeproject.org/files/ENCFF339KUO/@@download/ENCFF339KUO.bed.gz"</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20">)</a>
<a class="sourceLine" id="cb14-21" data-line-number="21">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addPeakAnnotations.html">addPeakAnnotations</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">regions =</span> EncodePeaks, <span class="dt">name =</span> <span class="st">"ChIP"</span>)</a>
<a class="sourceLine" id="cb14-22" data-line-number="22"></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#Identify ChIP Enrichments</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24">enrichRegions &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/peakAnnoEnrichment.html">peakAnnoEnrichment</a></span>(</a>
<a class="sourceLine" id="cb14-25" data-line-number="25">    <span class="dt">seMarker =</span> markersPeaks,</a>
<a class="sourceLine" id="cb14-26" data-line-number="26">    <span class="dt">ArchRProj =</span> proj,</a>
<a class="sourceLine" id="cb14-27" data-line-number="27">    <span class="dt">peakAnnotation =</span> <span class="st">"ChIP"</span>,</a>
<a class="sourceLine" id="cb14-28" data-line-number="28">    <span class="dt">cutOff =</span> <span class="st">"FDR &lt;= 0.1 &amp; Log2FC &gt;= 0.5"</span></a>
<a class="sourceLine" id="cb14-29" data-line-number="29">  )</a>
<a class="sourceLine" id="cb14-30" data-line-number="30">heatmapER &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/enrichHeatmap.html">enrichHeatmap</a></span>(enrichRegions, <span class="dt">n =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb14-31" data-line-number="31"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(heatmapER, <span class="dt">name =</span> <span class="st">"Regions-Enrich-Heatmap"</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div id="motif-enrichment" class="section level2">
<h2 class="hasAnchor">
<a href="#motif-enrichment" class="anchor"></a>Motif Enrichment</h2>
<br><br><center>
<embed src="../../images/Tutorial/Motifs-Enrich-Heatmap.pdf" width="450" height="600"></embed>
</center>
</div>
<div id="region-enrichment" class="section level2">
<h2 class="hasAnchor">
<a href="#region-enrichment" class="anchor"></a>Region Enrichment</h2>
<br><br><center>
<embed src="../../images/Tutorial/Regions-Enrich-Heatmap.pdf" width="450" height="600"></embed>
</center>
</div>
</div>
<div id="computing-chromvar-deviations" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#computing-chromvar-deviations" class="anchor"></a>Computing chromVAR Deviations</h1>
<p>Using the reproducible peak set that we defined above, we can use ArchR to calculate TF/Annotation deviations on a single-cell basis for transcription factors/annotations in the peaks identified in each cluster. We can then overlay these deviations on on UMAP embedding. This effectively infers differences in TF activity across all single cells and is very useful in identifying regulatory factors governing cell fate.</p>
<div id="motif-deviations" class="section level2">
<h2 class="hasAnchor">
<a href="#motif-deviations" class="anchor"></a>Motif Deviations</h2>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co">#Add Background Peaks to ArchR Project</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addBgdPeaks.html">addBgdPeaks</a></span>(proj)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#Add chromVAR Deviations (~20-25 min if using CisBP Motif Set)</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addDeviationsMatrix.html">addDeviationsMatrix</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">peakAnnotation =</span> <span class="st">"Motif"</span>)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#Plot Variable TFs</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8">plotVarDev &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getVarDeviations.html">getVarDeviations</a></span>(proj, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(plotVarDev, <span class="dt">name =</span> <span class="st">"Plot-Var-Deviations"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Plot-Var-Deviations.pdf" width="450" height="450"></embed>
</center>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co">#To access motif need to specify deviations,z : motif_name</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="co">#Try getFeatures with MotifMatrix to see available names</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="kw"><a href="../../reference/getFeatures.html">getFeatures</a></span>(proj, <span class="dt">select =</span> <span class="st">"PAX5"</span>, <span class="dt">useMatrix =</span> <span class="st">"MotifMatrix"</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#Define the list of motifs to plot</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">markerMotifs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"GATA1_383"</span>, <span class="st">"CEBPA_155"</span>, <span class="st">"EBF1_67"</span>, <span class="st">"IRF4_632"</span>, <span class="st">"TBX21_780"</span>, <span class="st">"PAX5_709"</span>)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#Plot Violins of motif deviations</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb16-11" data-line-number="11">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>, </a>
<a class="sourceLine" id="cb16-12" data-line-number="12">  <span class="dt">colorBy =</span> <span class="st">"MotifMatrix"</span>, </a>
<a class="sourceLine" id="cb16-13" data-line-number="13">  <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"z:"</span>,markerMotifs[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">  <span class="dt">imputeWeights =</span> <span class="kw"><a href="../../reference/getImputeWeights.html">getImputeWeights</a></span>(proj)</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb16-16" data-line-number="16">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb16-17" data-line-number="17">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>, </a>
<a class="sourceLine" id="cb16-18" data-line-number="18">  <span class="dt">colorBy =</span> <span class="st">"MotifMatrix"</span>, </a>
<a class="sourceLine" id="cb16-19" data-line-number="19">  <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"z:"</span>,markerMotifs[<span class="dv">6</span>]),</a>
<a class="sourceLine" id="cb16-20" data-line-number="20">  <span class="dt">imputeWeights =</span> <span class="kw"><a href="../../reference/getImputeWeights.html">getImputeWeights</a></span>(proj)</a>
<a class="sourceLine" id="cb16-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Groups-Marker-MotifDeviations-w-Imputation"</span>, <span class="dt">width =</span> <span class="dv">4</span>, <span class="dt">height =</span> <span class="dv">3</span>,  <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Groups-Marker-MotifDeviations-w-Imputation.pdf" width="450" height="350"></embed>
</center>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co">#Plot the UMAP Embedding with chromVAR Deviations Overlayed</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>)</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"MotifMatrix"</span>, <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"z:"</span>,markerMotifs), <span class="dt">imputeWeights =</span> <span class="kw"><a href="../../reference/getImputeWeights.html">getImputeWeights</a></span>(proj))</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Marker-MotifDeviations-w-Imputation"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/UMAP-Marker-MotifDeviations-w-Imputation.pdf" width="450" height="450"></embed>
</center>
</div>
<div id="region-deviations" class="section level2">
<h2 class="hasAnchor">
<a href="#region-deviations" class="anchor"></a>Region Deviations</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co">#Add Background Peaks to ArchR Project</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addBgdPeaks.html">addBgdPeaks</a></span>(proj)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#Add chromVAR Deviations</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addDeviationsMatrix.html">addDeviationsMatrix</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">peakAnnotation =</span> <span class="st">"ChIP"</span>)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#To access motif need to specify deviations,z : motif_name</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#Try getFeatures with MotifMatrix to see available names</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="kw"><a href="../../reference/getFeatures.html">getFeatures</a></span>(proj, <span class="dt">select =</span> <span class="st">"PAX5"</span>, <span class="dt">useMatrix =</span> <span class="st">"ChIPMatrix"</span>)</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co">#Define the list of regions to plot</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12">markerRegions &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Encode_K562_GATA1"</span>, <span class="st">"Encode_GM12878_CEBPB"</span>, <span class="st">"Encode_K562_Ebf1"</span>, <span class="st">"Encode_K562_Pax5"</span>)</a>
<a class="sourceLine" id="cb18-13" data-line-number="13"></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#Plot Violins of ChIP-seq deviations</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb18-16" data-line-number="16">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb18-17" data-line-number="17">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>, </a>
<a class="sourceLine" id="cb18-18" data-line-number="18">  <span class="dt">colorBy =</span> <span class="st">"ChIPMatrix"</span>, </a>
<a class="sourceLine" id="cb18-19" data-line-number="19">  <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"z:"</span>,markerRegions[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb18-20" data-line-number="20">  <span class="dt">imputeWeights =</span> <span class="kw"><a href="../../reference/getImputeWeights.html">getImputeWeights</a></span>(proj)</a>
<a class="sourceLine" id="cb18-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb18-22" data-line-number="22">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotGroups.html">plotGroups</a></span>(<span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb18-23" data-line-number="23">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>, </a>
<a class="sourceLine" id="cb18-24" data-line-number="24">  <span class="dt">colorBy =</span> <span class="st">"ChIPMatrix"</span>, </a>
<a class="sourceLine" id="cb18-25" data-line-number="25">  <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"z:"</span>,markerRegions[<span class="dv">4</span>]),</a>
<a class="sourceLine" id="cb18-26" data-line-number="26">  <span class="dt">imputeWeights =</span> <span class="kw"><a href="../../reference/getImputeWeights.html">getImputeWeights</a></span>(proj)</a>
<a class="sourceLine" id="cb18-27" data-line-number="27">)</a>
<a class="sourceLine" id="cb18-28" data-line-number="28"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Groups-Marker-ChIPDeviations-w-Imputation"</span>, <span class="dt">width =</span> <span class="dv">4</span>, <span class="dt">height =</span> <span class="dv">3</span>,  <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Groups-Marker-ChIPDeviations-w-Imputation.pdf" width="450" height="350"></embed>
</center>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co">#Plot the UMAP Embedding with chromVAR Deviations Overlayed</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>)</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"ChIPMatrix"</span>, <span class="dt">name =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"z:"</span>,markerRegions), <span class="dt">imputeWeights =</span> <span class="kw"><a href="../../reference/getImputeWeights.html">getImputeWeights</a></span>(proj))</a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"UMAP-Marker-ChIPDeviations-w-Imputation"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/UMAP-Marker-ChIPDeviations-w-Imputation.pdf" width="450" height="450"></embed>
</center>
</div>
</div>
<div id="performing-tf-footprinting" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#performing-tf-footprinting" class="anchor"></a>Performing TF Footprinting</h1>
<p>Transcription factor footprinting can also be done in ArchR with a single command. We note that the footprints generated by the tutorial data are not as clean as would be desired but this is because of the small size of the tutorial dataset.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co">#Plot Motif Footprints from positions list</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="co">#Recommend doing a few motifs not entire motif set</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">seFoot_None &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotFootprints.html">plotFootprints</a></span>(</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb20-5" data-line-number="5">  <span class="dt">positions =</span> <span class="kw"><a href="../../reference/getPositions.html">getPositions</a></span>(proj)[markerMotifs], </a>
<a class="sourceLine" id="cb20-6" data-line-number="6">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>,</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">  <span class="dt">normMethod =</span> <span class="st">"none"</span>,</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">  <span class="dt">plotName =</span> <span class="st">"Footprints-No-Normalization"</span></a>
<a class="sourceLine" id="cb20-9" data-line-number="9">)</a></code></pre></div>
<div id="no-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#no-normalization" class="anchor"></a>No Normalization</h2>
<br><br><center>
<embed src="../../images/Tutorial/Footprints-No-Normalization.pdf" width="450" height="650"></embed>
</center>
</div>
<div id="subtract-bias" class="section level2">
<h2 class="hasAnchor">
<a href="#subtract-bias" class="anchor"></a>Subtract Bias</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co">#Re-Plot with different normalization method</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2">seFoot_Subtract &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotFootprints.html">plotFootprints</a></span>(</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  <span class="dt">inputSE =</span> seFoot_None, </a>
<a class="sourceLine" id="cb21-5" data-line-number="5">  <span class="dt">positions =</span> <span class="kw"><a href="../../reference/getPositions.html">getPositions</a></span>(proj)[markerMotifs], </a>
<a class="sourceLine" id="cb21-6" data-line-number="6">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>,</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">  <span class="dt">normMethod =</span> <span class="st">"subtract"</span>,</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">  <span class="dt">plotName =</span> <span class="st">"Footprints-Subtract-Bias"</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9">)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Footprints-Subtract-Bias.pdf" width="450" height="650"></embed>
</center>
</div>
<div id="divide-bias" class="section level2">
<h2 class="hasAnchor">
<a href="#divide-bias" class="anchor"></a>Divide Bias</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co">#Re-Plot with different normalization method</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">seFoot_Divide &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotFootprints.html">plotFootprints</a></span>(</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  <span class="dt">inputSE =</span> seFoot_None, </a>
<a class="sourceLine" id="cb22-5" data-line-number="5">  <span class="dt">positions =</span> <span class="kw"><a href="../../reference/getPositions.html">getPositions</a></span>(proj)[markerMotifs], </a>
<a class="sourceLine" id="cb22-6" data-line-number="6">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>,</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">  <span class="dt">normMethod =</span> <span class="st">"divide"</span>,</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">  <span class="dt">plotName =</span> <span class="st">"Footprints-Divide-Bias"</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9">)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Footprints-Divide-Bias.pdf" width="450" height="650"></embed>
</center>
</div>
<div id="tss-enrichment" class="section level2">
<h2 class="hasAnchor">
<a href="#tss-enrichment" class="anchor"></a>TSS Enrichment</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co">#Add Coverages for Samples prior to footprint</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addGroupCoverages.html">addGroupCoverages</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">groupBy =</span> <span class="st">"Sample"</span>)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">#TSS by sample</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">TSS_Samples &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotFootprints.html">plotFootprints</a></span>(</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb23-7" data-line-number="7">  <span class="dt">positions =</span> <span class="kw">GRangesList</span>(<span class="dt">TSS =</span> <span class="kw"><a href="../../reference/getTSS.html">getTSS</a></span>(proj)), </a>
<a class="sourceLine" id="cb23-8" data-line-number="8">  <span class="dt">groupBy =</span> <span class="st">"Sample"</span>,</a>
<a class="sourceLine" id="cb23-9" data-line-number="9">  <span class="dt">normMethod =</span> <span class="st">"none"</span>,</a>
<a class="sourceLine" id="cb23-10" data-line-number="10">  <span class="dt">plotName =</span> <span class="st">"TSS_Samples"</span>,</a>
<a class="sourceLine" id="cb23-11" data-line-number="11">  <span class="dt">flank =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb23-12" data-line-number="12">  <span class="dt">flankNorm =</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb23-13" data-line-number="13">)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/TSS_Samples.pdf" width="450" height="650"></embed>
</center>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co">#TSS by clusters</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">TSS_Clusters &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotFootprints.html">plotFootprints</a></span>(</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="dt">ArchRProj =</span> proj, </a>
<a class="sourceLine" id="cb24-4" data-line-number="4">  <span class="dt">positions =</span> <span class="kw">GRangesList</span>(<span class="dt">TSS =</span> <span class="kw"><a href="../../reference/getTSS.html">getTSS</a></span>(proj)), </a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  <span class="dt">groupBy =</span> <span class="st">"Clusters"</span>,</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">  <span class="dt">normMethod =</span> <span class="st">"none"</span>,</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">  <span class="dt">plotName =</span> <span class="st">"TSS_Clusters"</span>,</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">  <span class="dt">flank =</span> <span class="dv">2000</span>,</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">  <span class="dt">flankNorm =</span> <span class="dv">100</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10">)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/TSS_Clusters.pdf" width="450" height="650"></embed>
</center>
</div>
</div>
<div id="analyze-trajectories" class="section level1 tabset tabset-fade tabset-pills">
<h1 class="hasAnchor">
<a href="#analyze-trajectories" class="anchor"></a>Analyze Trajectories</h1>
<div id="myeloid-trajectory" class="section level2">
<h2 class="hasAnchor">
<a href="#myeloid-trajectory" class="anchor"></a>Myeloid Trajectory</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co">#First we need to create a Trajectory and add it to ArchRProj cellColData</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addTrajectory.html">addTrajectory</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">name =</span> <span class="st">"Myeloid"</span>, <span class="dt">trajectory =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Cluster"</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>))))</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co">#Additionally we can plot these features on top of the UMAP embedding</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb25-6" data-line-number="6">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotTrajectory.html">plotTrajectory</a></span>(proj, <span class="dt">trajectory =</span> <span class="st">"Myeloid"</span>, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Myeloid"</span>)</a>
<a class="sourceLine" id="cb25-8" data-line-number="8">plotList[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotTrajectory.html">plotTrajectory</a></span>(proj, <span class="dt">trajectory =</span> <span class="st">"Myeloid"</span>, <span class="dt">colorBy =</span> <span class="st">"GeneScoreMatrix"</span>, <span class="dt">name =</span> <span class="st">"CEBPB"</span>)</a>
<a class="sourceLine" id="cb25-9" data-line-number="9">plotList[[<span class="dv">4</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotTrajectory.html">plotTrajectory</a></span>(proj, <span class="dt">trajectory =</span> <span class="st">"Myeloid"</span>, <span class="dt">colorBy =</span> <span class="st">"MotifMatrix"</span>, <span class="dt">name =</span> <span class="st">"z:CEBPB_140"</span>)</a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Plot-UMAP-Myeloid-Trajectory"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Plot-UMAP-Myeloid-Trajectory.pdf" width="450" height="650"></embed>
</center>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co">#Next we can access variable features across the trajectory and summarize</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">TrajMyeloidMM &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getTrajectory.html">getTrajectory</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">name =</span> <span class="st">"Myeloid"</span>, <span class="dt">useMatrix =</span> <span class="st">"MotifMatrix"</span>, <span class="dt">log2Norm =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb26-3" data-line-number="3">TrajMyeloidGS &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getTrajectory.html">getTrajectory</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">name =</span> <span class="st">"Myeloid"</span>, <span class="dt">useMatrix =</span> <span class="st">"GeneScoreMatrix"</span>)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="co">#We can then plot a heatmap for this trajectory to see variable features</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/trajectoryHeatmap.html">trajectoryHeatmap</a></span>(TrajMyeloidMM)</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/trajectoryHeatmap.html">trajectoryHeatmap</a></span>(TrajMyeloidGS)</a>
<a class="sourceLine" id="cb26-9" data-line-number="9"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Myeloid-Trajectory-Heatmap"</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Myeloid-Trajectory-Heatmap.pdf" width="450" height="650"></embed>
</center>
</div>
<div id="lymphoid-trajectory" class="section level2">
<h2 class="hasAnchor">
<a href="#lymphoid-trajectory" class="anchor"></a>Lymphoid Trajectory</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co">#First we need to create a Trajectory and add it to ArchRProj cellColData</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2">proj &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/addTrajectory.html">addTrajectory</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">name =</span> <span class="st">"Lymphoid"</span>, <span class="dt">trajectory =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"Cluster"</span>, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>))))</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="co">#Additionally we can plot these features on top of the UMAP embedding</span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotEmbedding.html">plotEmbedding</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Clusters"</span>, <span class="dt">plotParams =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">labelMeans=</span><span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotTrajectory.html">plotTrajectory</a></span>(proj, <span class="dt">trajectory =</span> <span class="st">"Lymphoid"</span>, <span class="dt">colorBy =</span> <span class="st">"colData"</span>, <span class="dt">name =</span> <span class="st">"Lymphoid"</span>)</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">plotList[[<span class="dv">3</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotTrajectory.html">plotTrajectory</a></span>(proj, <span class="dt">trajectory =</span> <span class="st">"Lymphoid"</span>, <span class="dt">colorBy =</span> <span class="st">"GeneScoreMatrix"</span>, <span class="dt">name =</span> <span class="st">"PAX5"</span>)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9">plotList[[<span class="dv">4</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/plotTrajectory.html">plotTrajectory</a></span>(proj, <span class="dt">trajectory =</span> <span class="st">"Lymphoid"</span>, <span class="dt">colorBy =</span> <span class="st">"MotifMatrix"</span>, <span class="dt">name =</span> <span class="st">"z:PAX5_709"</span>)</a>
<a class="sourceLine" id="cb27-10" data-line-number="10"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Plot-UMAP-Lymphoid-Trajectory"</span>, <span class="dt">width =</span> <span class="dv">6</span>, <span class="dt">height =</span> <span class="dv">6</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Plot-UMAP-Lymphoid-Trajectory.pdf" width="450" height="650"></embed>
</center>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co">#Next we can access variable features across the trajectory and summarize</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">TrajLymphoidMM &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getTrajectory.html">getTrajectory</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">name =</span> <span class="st">"Lymphoid"</span>, <span class="dt">useMatrix =</span> <span class="st">"MotifMatrix"</span>, <span class="dt">log2Norm =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3">TrajLymphoidGS &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/getTrajectory.html">getTrajectory</a></span>(<span class="dt">ArchRProj =</span> proj, <span class="dt">name =</span> <span class="st">"Lymphoid"</span>, <span class="dt">useMatrix =</span> <span class="st">"GeneScoreMatrix"</span>)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4"></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#We can then plot a heatmap for this trajectory to see variable features</span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6">plotList &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>()</a>
<a class="sourceLine" id="cb28-7" data-line-number="7">plotList[[<span class="dv">1</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/trajectoryHeatmap.html">trajectoryHeatmap</a></span>(TrajLymphoidMM, <span class="dt">labelMarkers =</span> <span class="st">"PAX5_709"</span>)</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">plotList[[<span class="dv">2</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/trajectoryHeatmap.html">trajectoryHeatmap</a></span>(TrajLymphoidGS)</a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="kw"><a href="../../reference/plotPDF.html">plotPDF</a></span>(<span class="dt">plotList =</span> plotList, <span class="dt">name =</span> <span class="st">"Lymphoid-Trajectory-Heatmap"</span>, <span class="dt">width =</span> <span class="dv">8</span>, <span class="dt">height =</span> <span class="dv">12</span>, <span class="dt">ArchRProj =</span> proj, <span class="dt">addDOC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<br><br><center>
<embed src="../../images/Tutorial/Lymphoid-Trajectory-Heatmap.pdf" width="450" height="650"></embed>
</center>
</div>
</div>
<div id="citation" class="section level1">
<h1 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h1>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ol style="list-style-type: decimal">
<li>
<li>
<li>
<li>
<li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#please-view-the-tutorial-in-safari-firefox-or-internet-explorer-chromes-pdf-viewer-doesnt-load-all-of-the-pdfs-in-the-tutorial-">Please view the tutorial in safari, firefox or internet explorer (chrome’s pdf viewer doesnt load all of the pdf’s in the tutorial).</a></li>
      <li><a href="#what-is-an-arrowfile-archrproject">What is an <code>ArrowFile</code> / <code>ArchRProject</code>?</a></li>
      <li><a href="#getting-set-up">Getting Set Up</a></li>
      <li>
<a href="#creating-arrow-files">Creating Arrow Files</a><ul class="nav nav-pills nav-stacked">
<li><a href="#qc-tss-scores-by-unique-fragments">QC TSS Scores by Unique Fragments</a></li>
      <li><a href="#qc-fragment-size-distribution">QC Fragment Size Distribution</a></li>
      </ul>
</li>
      <li>
<a href="#tidying-up-our-data-and-creating-an-archrproject">Tidying up our data and creating an <code>ArchRProject</code></a><ul class="nav nav-pills nav-stacked">
<li><a href="#example-doublet-results">Example Doublet Results</a></li>
      <li><a href="#tss-doublet-enrichment">TSS / Doublet Enrichment</a></li>
      </ul>
</li>
      <li>
<a href="#dimensionality-reduction">Dimensionality Reduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#umap-w-clusters">UMAP w/ Clusters</a></li>
      <li><a href="#tsne-w-clusters">TSNE w/ Clusters</a></li>
      <li><a href="#umap-w-custom-coldata">UMAP w/ Custom ColData</a></li>
      </ul>
</li>
      <li>
<a href="#identifying-cluster-cell-types-using-marker-genes">Identifying Cluster Cell Types Using Marker Genes</a><ul class="nav nav-pills nav-stacked">
<li><a href="#umap-genescores-w-imputation">UMAP GeneScores w/ Imputation</a></li>
      <li><a href="#umap-genescores-wo-imputation">UMAP GeneScores w/o Imputation</a></li>
      <li><a href="#track-plots">Track-Plots</a></li>
      <li><a href="#marker-genescores-heatmap">Marker GeneScores Heatmap</a></li>
      </ul>
</li>
      <li>
<a href="#creating-a-reproducible-peak-set">Creating a Reproducible Peak Set</a><ul class="nav nav-pills nav-stacked">
<li><a href="#reproducible-peaks-per-cluster">Reproducible Peaks per Cluster</a></li>
      <li><a href="#frip-tss-enrichment-per-sample">FRIP / TSS Enrichment Per Sample</a></li>
      </ul>
</li>
      <li>
<a href="#identifying-marker-peaks">Identifying Marker Peaks</a><ul class="nav nav-pills nav-stacked">
<li><a href="#markers-heatmap">Markers Heatmap</a></li>
      <li><a href="#markers-mavolcano-plot">Markers MA/Volcano-Plot</a></li>
      <li><a href="#pairwise-test">Pairwise-Test</a></li>
      </ul>
</li>
      <li>
<a href="#performing-peak-annotation-enrichments">Performing Peak Annotation Enrichments</a><ul class="nav nav-pills nav-stacked">
<li><a href="#motif-enrichment">Motif Enrichment</a></li>
      <li><a href="#region-enrichment">Region Enrichment</a></li>
      </ul>
</li>
      <li>
<a href="#computing-chromvar-deviations">Computing chromVAR Deviations</a><ul class="nav nav-pills nav-stacked">
<li><a href="#motif-deviations">Motif Deviations</a></li>
      <li><a href="#region-deviations">Region Deviations</a></li>
      </ul>
</li>
      <li>
<a href="#performing-tf-footprinting">Performing TF Footprinting</a><ul class="nav nav-pills nav-stacked">
<li><a href="#no-normalization">No Normalization</a></li>
      <li><a href="#subtract-bias">Subtract Bias</a></li>
      <li><a href="#divide-bias">Divide Bias</a></li>
      <li><a href="#tss-enrichment">TSS Enrichment</a></li>
      </ul>
</li>
      <li>
<a href="#analyze-trajectories">Analyze Trajectories</a><ul class="nav nav-pills nav-stacked">
<li><a href="#myeloid-trajectory">Myeloid Trajectory</a></li>
      <li><a href="#lymphoid-trajectory">Lymphoid Trajectory</a></li>
      </ul>
</li>
      <li><a href="#citation">Citation</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://twitter.com/JeffreyGranja">Jeffrey Granja</a>, <a href="https://twitter.com/doctorcorces">Ryan Corces</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
